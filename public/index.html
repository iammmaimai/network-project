<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/style.css" />
    <title>Pingu TALK!</title>
</head>
<body class="join-page">
    <div class="join-container">
        <header class="join-header">
            <h1><i class="fas fa-light fa-snowflake"></i> Pingu</h1>
        </header>
        <main class="join-main">
            <form id="join-form">
                <div class="form-control">
                    <label for="username">Username</label>
                    <input
                        type="text"
                        name="username"
                        id="username"
                        placeholder="Enter username..."
                        required
                    />
                </div>

                <!-- Main Room Option -->
                <div class="destination-option">
                    <h4><i class="fas fa-home"></i> Main Room</h4>
                    <div class="main-room-card">
                        <div class="room-icon main-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="room-info">
                            <div class="room-name">Main Room</div>
                            <div class="room-description">General chat for everyone</div>
                            <div class="room-count">
                                <i class="fas fa-users"></i> <span id="main-room-count"></span> online
                            </div>
                        </div>
                        <button type="button" id="join-main-room" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> Join Main Room
                        </button>
                    </div>
                </div>
            </form>
        </main>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const usernameInput = document.getElementById('username');
        const groupsList = document.getElementById('groups-list');
        const mainRoomCountEl = document.getElementById('main-room-count');
        
        let availableGroups = [];
        let mainRoomCount = 0;

        // Request initial data
        socket.emit('getMainRoomCount');
        socket.emit('getAllGroups');

        // Receive main room count
        socket.on('mainRoomCount', (count) => {
            mainRoomCount = count;
            mainRoomCountEl.textContent = count;
        });

        // Receive available groups
        socket.on('allGroupsList', (groups) => {
            availableGroups = groups;
            displayGroups();
        });

        // Join Main Room
        document.getElementById('join-main-room').addEventListener('click', () => {
            const username = usernameInput.value.trim();
            if (!username) {
                alert('Please enter a username');
                usernameInput.focus();
                return;
            }
            window.location.href = `chat.html?username=${encodeURIComponent(username)}&room=Main Room`;
        });

        // Refresh data periodically
        setInterval(() => {
            socket.emit('getMainRoomCount');
            socket.emit('getAllGroups');
        }, 5000);
    </script>
</body>
</html>